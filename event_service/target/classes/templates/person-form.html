<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <th:block th:include="bootstrap/css.html"/>
    <title>E-G-S</title>
</head>
<body class="bg">
<th:block th:include="header/headerTitle.html"/>
<br/><br/>
<div class="container">
    <div class="row">
        <div class="col-md-6 col-md-offset-3">

            <div th:if="${param.success}">
                <div class="alert alert-info">
                    You've successfully updated!
                </div>
            </div>
            <div class="card text-white bg-dark">
                <h1>EDIT PERSON</h1>
                <span sec:authorize="isAuthenticated()">
                <span sec:authentication="name"></span>
                <br/>Roles: <span sec:authentication="principal.authorities"></span>
                </span>
                <form action="/user/saveUpdatedPerson" th:object="${person}" method="post">
                    <input type="hidden" th:field="*{email}"/>
                    <p class="error-message"
                       th:if="${#fields.hasGlobalErrors()}"
                       th:each="error : ${#fields.errors('global')}"
                       th:text="${error}">Validation error</p>
                    <br/><br/>
                    <div class="form-group"
                         th:classappend="${#fields.hasErrors('roles')}? 'has-error':''">
                        <label for="roles" class="control-label"><h4>Role</h4></label>

                        <select id="roles" class="form-control" th:field="*{role}">
                            <option th:value="'ROLE_USER'" th:text="ROLE_USER"></option>
                            <option th:value="'ROLE_ORGANIZER'" th:text="ROLE_ORGANIZER"></option>
                            <option sec:authorize="hasRole('ADMIN')" th:value="'ROLE_ADMIN'"
                                    th:text="ROLE_ADMIN"></option>
                        </select>
                        <p class="error-message"
                           th:each="error: ${#fields.errors('role')}"
                           th:text="${error}">Validation error</p>
                    </div>


                            <div class="form-group">
                                <button type="submit" class="btn btn-success">Update</button>
                            </div>
                        </form>
                        <br/><br/>
                        <label for="roles" class="control-label"><h4>My Events list:</h4></label>

                        <th:block th:each="myEvent : ${person.eventList}">
                            <div class="form-group">
                                <a th:href="@{/showDetails(eventId=${myEvent.id})}">
                                    <div class="card-text" th:text="${myEvent.title}"></div>
                                </a>
                            </div>
                        </th:block>
                    </div>
                </div>
            </div>
        </div>

<th:block th:include="bootstrap/js.html"/>
</body>
</html>